import{x as i,z as o,Q as S,ac as V,r as R,_ as f,q as W,y as c,K as _,C as U,P as u,L as T,O as x,S as v,aq as B}from"./vue-vendor-Bsazo-x0.js";import{_ as O,c as h,s as d}from"./index-D1lgCGbM.js";import"./element-plus-CqiD73Lu.js";import"./vendor-Dr8jvgFu.js";const A={name:"PromptsView",setup(){const M=[{id:"codex",name:"Codex CLI",description:"OpenAI Responses 服务的默认提示词",icon:"fas fa-code"},{id:"claudeCode",name:"Claude Code",description:"Claude Code 服务的默认提示词",icon:"fas fa-robot"},{id:"droid",name:"Droid",description:"Droid (Factory.ai) 服务的默认提示词",icon:"fas fa-wrench"}],e=[{id:"manual",name:"手动编辑",icon:"fas fa-edit"},{id:"upload",name:"文件上传",icon:"fas fa-upload"},{id:"url",name:"URL 导入",icon:"fas fa-link"}],k=R(!1),a=f({codex:"",claudeCode:"",droid:""}),P=f({}),w=f({}),t=f({}),g=f({}),s=f({codex:"manual",claudeCode:"manual",droid:"manual"}),y=f({codex:"",claudeCode:"",droid:""}),F=f({codex:null,claudeCode:null,droid:null}),C=async()=>{k.value=!0;try{for(const r of M){const n=await h.get(`/admin/prompts/${r.id}`);n.success&&(a[r.id]=n.content||"",P[r.id]={lastModified:n.lastModified,enabled:n.enabled,length:n.length})}}catch(r){console.error("Failed to load prompts:",r),d("加载 Prompts 失败","error")}finally{k.value=!1}},L=async r=>{var n,p;w[r]=!0;try{const m=await h.put(`/admin/prompts/${r}`,{content:a[r]});m.success?(d("保存成功","success"),await C()):d(m.error||"保存失败","error")}catch(m){console.error(`Failed to save ${r} prompt:`,m),d(((p=(n=m.response)==null?void 0:n.data)==null?void 0:p.error)||"保存失败","error")}finally{w[r]=!1}},j=()=>{const r=document.querySelector('input[type="file"][accept=".txt"]');r&&(r.value="",r.click())},z=async(r,n)=>{var m,l;const p=n.target.files[0];if(p){if(!p.name.endsWith(".txt")){d("仅支持 .txt 文件","error");return}if(p.size>1024*1024){d("文件大小不能超过 1MB","error");return}t[r]=!0;try{const b=new FormData;b.append("file",p);const D=await h.post(`/admin/prompts/${r}/upload`,b,{headers:{"Content-Type":"multipart/form-data"}});D.success?(d("上传成功","success"),await C(),s[r]="manual"):d(D.error||"上传失败","error")}catch(b){console.error(`Failed to upload ${r} prompt:`,b),d(((l=(m=b.response)==null?void 0:m.data)==null?void 0:l.error)||"上传失败","error")}finally{t[r]=!1}}},H=async r=>{var p,m;const n=y[r];if(n){if(!n.startsWith("https://")){d("仅支持 HTTPS 协议","error");return}g[r]=!0;try{const l=await h.post(`/admin/prompts/${r}/import-url`,{url:n,validate:!0});l.success?(F[r]=l.preview||l.content,d("预览加载成功","success")):d(l.error||"预览失败","error")}catch(l){console.error(`Failed to preview ${r} prompt:`,l),d(((m=(p=l.response)==null?void 0:p.data)==null?void 0:m.error)||"预览失败","error")}finally{g[r]=!1}}},N=async r=>{var p,m;const n=y[r];if(n){if(!n.startsWith("https://")){d("仅支持 HTTPS 协议","error");return}g[r]=!0;try{const l=await h.post(`/admin/prompts/${r}/import-url`,{url:n,validate:!1});l.success?(d("导入成功","success"),await C(),s[r]="manual",y[r]="",F[r]=null):d(l.error||"导入失败","error")}catch(l){console.error(`Failed to import ${r} prompt:`,l),d(((m=(p=l.response)==null?void 0:p.data)==null?void 0:m.error)||"导入失败","error")}finally{g[r]=!1}}},q=r=>r?new Date(r).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"";return W(()=>{C()}),{services:M,editModes:e,loading:k,prompts:a,metadata:P,saving:w,uploading:t,importing:g,currentMode:s,importUrls:y,urlPreviews:F,savePrompt:L,triggerFileUpload:j,handleFileUpload:z,previewFromUrl:H,importFromUrl:N,formatDateTime:q}}},E={class:"prompts-container"},K={class:"card p-4 sm:p-6"},Q={key:0,class:"py-12 text-center"},G={key:1,class:"space-y-6"},J={class:"mb-4 flex items-center justify-between"},X={class:"flex items-center"},Y={class:"mr-3 flex h-10 w-10 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 text-white"},Z={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},$={class:"text-sm text-gray-500 dark:text-gray-400"},I={class:"text-right"},tt={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},ot={key:0,class:"inline-flex items-center rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-200"},at={class:"mb-4"},rt={class:"flex space-x-4"},et=["onClick"],st=["onUpdate:modelValue","placeholder","rows"],nt={class:"mt-3 flex items-center justify-between"},dt={class:"text-xs text-gray-500 dark:text-gray-400"},lt={key:0},it=["disabled","onClick"],ct={key:0,class:"loading-spinner mr-2"},mt={key:1,class:"fas fa-save mr-2"},pt={class:"rounded-lg bg-gray-50 p-6 dark:bg-gray-700"},ut=["onChange"],gt=["disabled"],ft={key:0,class:"loading-spinner mr-2"},xt={key:1,class:"fas fa-upload mr-2"},yt={class:"space-y-3"},bt=["for"],_t=["id","onUpdate:modelValue"],ht={class:"flex items-center space-x-3"},kt=["disabled","onClick"],wt=["disabled","onClick"],Ct={key:0,class:"loading-spinner mr-2"},Ut={key:1,class:"fas fa-download mr-2"},Mt={key:0,class:"mt-4 rounded-lg bg-gray-50 p-4 dark:bg-gray-700"},Pt={class:"mb-2 flex items-center justify-between"},Ft=["onClick"],Tt={class:"max-h-64 overflow-auto rounded border border-gray-200 bg-white p-3 text-xs dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300"};function vt(M,e,k,a,P,w){return c(),i("div",E,[o("div",K,[e[8]||(e[8]=o("div",{class:"mb-4 sm:mb-6"},[o("h3",{class:"mb-1 text-lg font-bold text-gray-900 dark:text-gray-100 sm:mb-2 sm:text-xl"}," System Prompts 管理 "),o("p",{class:"text-sm text-gray-600 dark:text-gray-400 sm:text-base"}," 管理各服务的默认系统提示词 ")],-1)),a.loading?(c(),i("div",Q,e[1]||(e[1]=[o("div",{class:"loading-spinner mx-auto mb-4"},null,-1),o("p",{class:"text-gray-500 dark:text-gray-400"},"正在加载 Prompts...",-1)]))):(c(),i("div",G,[(c(!0),i(S,null,V(a.services,t=>{var g;return c(),i("div",{key:t.id,class:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800 sm:p-6"},[o("div",J,[o("div",X,[o("div",Y,[o("i",{class:U(["text-lg",t.icon])},null,2)]),o("div",null,[o("h3",Z,u(t.name),1),o("p",$,u(t.description),1)])]),o("div",I,[o("div",tt,[a.prompts[t.id]?(c(),i("span",ot,u(a.prompts[t.id].length)+" 字符 ",1)):T("",!0)])])]),o("div",at,[o("nav",rt,[(c(!0),i(S,null,V(a.editModes,s=>(c(),i("button",{key:s.id,class:U(["rounded-lg px-3 py-2 text-sm font-medium transition-colors",a.currentMode[t.id]===s.id?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-200":"text-gray-600 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-200"]),onClick:y=>a.currentMode[t.id]=s.id},[o("i",{class:U(["mr-2",s.icon])},null,2),x(" "+u(s.name),1)],10,et))),128))])]),_(o("div",null,[_(o("textarea",{"onUpdate:modelValue":s=>a.prompts[t.id]=s,class:"form-input w-full font-mono text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",placeholder:`输入 ${t.name} 的 system prompt...`,rows:t.id==="codex"?25:3},null,8,st),[[B,a.prompts[t.id]]]),o("div",nt,[o("div",dt,[(g=a.metadata[t.id])!=null&&g.lastModified?(c(),i("span",lt,[e[2]||(e[2]=o("i",{class:"fas fa-clock mr-1"},null,-1)),x(" 最后修改: "+u(a.formatDateTime(a.metadata[t.id].lastModified)),1)])):T("",!0)]),o("button",{class:U(["btn btn-primary px-4 py-2",{"cursor-not-allowed opacity-50":a.saving[t.id]}]),disabled:a.saving[t.id],onClick:s=>a.savePrompt(t.id)},[a.saving[t.id]?(c(),i("div",ct)):(c(),i("i",mt)),x(" "+u(a.saving[t.id]?"保存中...":"保存"),1)],10,it)])],512),[[v,a.currentMode[t.id]==="manual"]]),_(o("div",null,[o("div",pt,[e[3]||(e[3]=o("div",{class:"mb-4 text-center"},[o("i",{class:"fas fa-upload mb-2 text-4xl text-gray-400 dark:text-gray-500"}),o("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"支持 .txt 格式，最大 1MB")],-1)),o("input",{ref_for:!0,ref:`fileInput_${t.id}`,accept:".txt",class:"hidden",type:"file",onChange:s=>a.handleFileUpload(t.id,s)},null,40,ut),o("button",{class:"btn btn-success mx-auto block px-6 py-3",disabled:a.uploading[t.id],onClick:e[0]||(e[0]=s=>a.triggerFileUpload())},[a.uploading[t.id]?(c(),i("div",ft)):(c(),i("i",xt)),x(" "+u(a.uploading[t.id]?"上传中...":"选择文件上传"),1)],8,gt)])],512),[[v,a.currentMode[t.id]==="upload"]]),_(o("div",null,[o("div",yt,[o("div",null,[o("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",for:`url_${t.id}`}," HTTPS URL ",8,bt),_(o("input",{id:`url_${t.id}`,"onUpdate:modelValue":s=>a.importUrls[t.id]=s,class:"form-input w-full dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",placeholder:"https://example.com/prompt.txt",type:"url"},null,8,_t),[[B,a.importUrls[t.id]]]),e[4]||(e[4]=o("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 仅支持 HTTPS 协议，最大 1MB ",-1))]),o("div",ht,[o("button",{class:"btn btn-primary px-4 py-2",disabled:!a.importUrls[t.id]||a.importing[t.id],onClick:s=>a.previewFromUrl(t.id)},e[5]||(e[5]=[o("i",{class:"fas fa-eye mr-2"},null,-1),x(" 预览 ",-1)]),8,kt),o("button",{class:"btn btn-success px-4 py-2",disabled:!a.importUrls[t.id]||a.importing[t.id],onClick:s=>a.importFromUrl(t.id)},[a.importing[t.id]?(c(),i("div",Ct)):(c(),i("i",Ut)),x(" "+u(a.importing[t.id]?"导入中...":"直接导入"),1)],8,wt)]),a.urlPreviews[t.id]?(c(),i("div",Mt,[o("div",Pt,[e[7]||(e[7]=o("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"}," 预览内容 ",-1)),o("button",{class:"text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",onClick:s=>a.urlPreviews[t.id]=null},e[6]||(e[6]=[o("i",{class:"fas fa-times"},null,-1)]),8,Ft)]),o("pre",Tt,u(a.urlPreviews[t.id]),1)])):T("",!0)])],512),[[v,a.currentMode[t.id]==="url"]])])}),128))]))])])}const Lt=O(A,[["render",vt],["__scopeId","data-v-04342dd2"]]);export{Lt as default};
